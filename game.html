<script type="text/javascript">
  var gk_isXlsx = false;
  var gk_xlsxFileLookup = {};
  var gk_fileData = {};
  function loadFileData(filename) {
  if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
      try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];

          // Convert sheet to JSON to filter blank rows
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          // Filter out blank rows (rows where all cells are empty, null, or undefined)
          var filteredData = jsonData.filter(row =>
              row.some(cell => cell !== '' && cell !== null && cell !== undefined)
          );

          // Convert filtered JSON back to CSV
          var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
      } catch (e) {
          console.error(e);
          return "";
      }
  }
  return gk_fileData[filename] || "";
  }
</script>
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–∞–π–Ω–∞ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –õ–æ–≥–∞—Ä–∏—Ñ–º–∞: –•–∞–∫–µ—Ä—Å–∫–∞—è –º–∏—Å—Å–∏—è</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="styles/styles.css">
</head>
<body>
<canvas class="matrix" id="matrix"></canvas>
<header>
<div class="header-content">
<img src="https://i.postimg.cc/q74Fdnpr/IMG-20250415-113958.png" alt="Logo" class="logo">
<h1>–¢–∞–π–Ω–∞ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –õ–æ–≥–∞—Ä–∏—Ñ–º–∞: –•–∞–∫–µ—Ä—Å–∫–∞—è –º–∏—Å—Å–∏—è</h1>
</div>
</header>
<main>
<!-- –°—Ü–µ–Ω–∞ 1: –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ -->
<section class="scene" id="scene1">
<h2>–ü—Ä–æ–ø–∞–≤—à–∏–π –≥–µ–Ω–∏–π</h2>
<p>–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –õ–æ–≥–∞—Ä–∏—Ñ–º, –ª–µ–≥–µ–Ω–¥–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, –∑–∞–≥–∞–¥–æ—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏—Å—á–µ–∑. –ï–≥–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–µ–¥ –≤–µ–¥—ë—Ç –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é "ZeroDivision". –í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Ö–∞–∫–µ—Ä, –ø—Ä–∏–∑–≤–∞–Ω–Ω—ã–π —Ä–∞—Å–∫—Ä—ã—Ç—å –ø—Ä–∞–≤–¥—É. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ –∑–∞–ø–µ—Ä—Ç–∞—è –¥–≤–µ—Ä—å, –º–∏–≥–∞—é—â–∏–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏. –ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ—é –º–∏—Å—Å–∏—é!</p>
<button class="btn" onclick="startPath()">–ù–∞—á–∞—Ç—å –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ</button>
</section>

<!-- –§–∞–∑–∞ 1: –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–∞ -->
<section class="scene hidden" id="path1">
<h2>–§–∞–∑–∞ 1 ‚Äì –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–∞</h2>
<p>–ü–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏, —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞ –∑–∞–º–∫–∞–º–∏ —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–∫–∏. –ù–∞–π–¥–∏—Ç–µ –∫–ª—é—á ¬´üîë¬ª!</p>
<div class="search-area" id="search1">
  <div class="search-item locked pos-1" data-hidden="üíæ" 
       onclick="unlockItem(this, '3', 'üíæ', 'log‚ÇÇ(8)')"></div>
  <div class="search-item locked pos-2" data-hidden="üîß" 
       onclick="unlockItem(this, '5', 'üîß', '‚àö(16 + 9)')"></div>
  <div class="search-item locked pos-3" data-hidden="üì±" 
       onclick="unlockItem(this, '2', 'üì±', '‚à´‚ÇÄ¬≤ x dx')"></div>
  <div class="search-item locked pos-4" data-hidden="üñ•Ô∏è" 
       onclick="unlockItem(this, '30', 'üñ•Ô∏è', '5! / 4')"></div>
  <div class="search-item locked pos-5" data-hidden="üñ®Ô∏è" 
       onclick="unlockItem(this, '1', 'üñ®Ô∏è', 'sin(œÄ/2)')"></div>
  <div class="search-item locked pos-6" data-hidden="üì∑" 
       onclick="unlockItem(this, '4', 'üì∑', '2x - 4 = 4')"></div>
  <div class="search-item locked pos-7" data-hidden="üóùÔ∏è" 
       onclick="unlockItem(this, '1', 'üóùÔ∏è', 'e‚Å∞')"></div>
  <div class="search-item locked pos-8" data-hidden="üîë" 
       onclick="unlockItem(this, '2', 'üîë', 'log‚ÇÉ(9)')"></div>
</div>
<p id="result1" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(1)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 2: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–æ–≤ -->
<section class="scene hidden" id="path2">
<h2>–§–∞–∑–∞ 2 ‚Äì –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–æ–≤</h2>
<p>–ù–∞ –ø–∞–Ω–µ–ª–∏ —Å–ª–µ–≤–∞ ‚Äî —á–∏—Å–ª–∞, —Å–ø—Ä–∞–≤–∞ ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è. –°–æ–µ–¥–∏–Ω–∏—Ç–µ –∏—Ö –ø—Ä–æ–≤–æ–¥–∞–º–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤—ã—Ä–∞–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–æ–¥–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—Ç—å, –ø–æ–∫–∞ –≤—Å–µ –ø–∞—Ä—ã –Ω–µ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏.</p>
<div class="wire-task" id="wireTask">
  <!-- –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (—á–∏—Å–ª–∞) -->
  <div class="wire-point pos-left1" id="left1" onmousedown="startDraggingWire('v1', this, event)" onmouseup="stopDraggingWire(this)">16</div>
  <div class="wire-point pos-left2" id="left2" onmousedown="startDraggingWire('v2', this, event)" onmouseup="stopDraggingWire(this)">6</div>
  <div class="wire-point pos-left3" id="left3" onmousedown="startDraggingWire('v3', this, event)" onmouseup="stopDraggingWire(this)">2</div>
  <div class="wire-point pos-left4" id="left4" onmousedown="startDraggingWire('v4', this, event)" onmouseup="stopDraggingWire(this)">1</div>
  <div class="wire-point pos-left5" id="left5" onmousedown="startDraggingWire('v5', this, event)" onmouseup="stopDraggingWire(this)">24</div>
  <div class="wire-point pos-left6" id="left6" onmousedown="startDraggingWire('v6', this, event)" onmouseup="stopDraggingWire(this)">8</div>
  
  <!-- –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (—É—Ä–∞–≤–Ω–µ–Ω–∏—è) -->
  <div class="wire-point pos-right1" id="right1" data-equation="Math.cos(0)" onmouseup="stopDraggingWire(this)">cos(0)</div>
  <div class="wire-point pos-right2" id="right2" data-equation="Math.sqrt(4)" onmouseup="stopDraggingWire(this)">‚àö4</div>
  <div class="wire-point pos-right3" id="right3" data-equation="factorial(3)" onmouseup="stopDraggingWire(this)">3!</div>
  <div class="wire-point pos-right4" id="right4" data-equation="Math.pow(2, 4)" onmouseup="stopDraggingWire(this)">2‚Å¥</div>
  <div class="wire-point pos-right5" id="right5" data-equation="Math.pow(2, 3) * 3" onmouseup="stopDraggingWire(this)">2¬≥√ó3</div>
  <div class="wire-point pos-right6" id="right6" data-equation="Math.pow(2, 3)" onmouseup="stopDraggingWire(this)">2¬≥</div>
  
  <canvas class="wire-canvas" id="wireCanvas"></canvas>
</div>
<p id="result2" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(2)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 3: –£—Å–ª–æ–∂–Ω—ë–Ω–Ω—ã–π —Ä–µ–±—É—Å -->
<section class="scene hidden" id="path3">
<h2>–§–∞–∑–∞ 3 ‚Äì –†–µ–±—É—Å</h2>
<p>–†–µ–±—É—Å:<br>
   1. –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ —Å–ª–æ–≤–∞ ¬´—Å–µ–∫—Ä–µ—Ç¬ª;<br>
   2. –ö–æ—Ä–µ–Ω—å —Å–ª–æ–≤–∞ ¬´–∫—Ä—ã—à–∞¬ª (–ø–µ—Ä–≤—ã–µ —Ç—Ä–∏ –±—É–∫–≤—ã);<br>
   3. –û–∫–æ–Ω—á–∞–Ω–∏–µ —Å–ª–æ–≤–∞ ¬´–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å¬ª (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —á–µ—Ç—ã—Ä–µ –±—É–∫–≤—ã).<br>
   –ú–µ–∂–¥—É 2-–π –∏ 3-–π —á–∞—Å—Ç—è–º–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –±—É–∫–≤—ã ¬´–¢–ù¬ª.<br>
   –ö–∞–∫–æ–π –ø–æ–ª—É—á–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç?</p>
<button class="btn" onclick="solveRebus()">–†–µ—à–∏—Ç—å —Ä–µ–±—É—Å</button>
<p id="result3" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(3)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 4: –®–∏—Ñ—Ä -->
<section class="scene hidden" id="path4">
<h2>–§–∞–∑–∞ 4 ‚Äì –®–∏—Ñ—Ä</h2>
<p>–†–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:<br>
   <strong>"–ª–ø–µ —Ä—Å–ø—Ö–∂—Ç—Ç–ø—Å–± –º–ø–¥–±—Å–π—Ö–Ω–±"</strong><br>
   –ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–¥–≤–∏–Ω—å—Ç–µ –∫–∞–∂–¥—É—é –±—É–∫–≤—É –Ω–∞ 1 –Ω–∞–∑–∞–¥.<br>
   –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å—Å—è: <em>–∫–æ–¥ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –ª–æ–≥–∞—Ä–∏—Ñ–º–∞</em>.
</p>
<button class="btn" onclick="solveCipher()">–†–µ—à–∏—Ç—å —à–∏—Ñ—Ä</button>
<p id="result4" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(4)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 5: –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª -->
<section class="scene hidden" id="path5">
<h2>–§–∞–∑–∞ 5 ‚Äì –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª</h2>
<p>–í—ã –ø–æ–ø–∞–ª–∏ –≤ —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–Ω–∞—Ç—É. –¢–µ—Ä–º–∏–Ω–∞–ª —Ç—Ä–µ–±—É–µ—Ç –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞. –ù–∞ –∑–∞–ø–∏—Å–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–æ: "–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –∑–¥–µ—Å—å". –†–µ—à–∏—Ç–µ, –∫–∞–∫ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å:</p>
<button class="btn" onclick="chooseAction(5, 'hack')">–í–∑–ª–æ–º–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª</button>
<button class="btn" onclick="chooseAction(5, 'search')">–ò—Å–∫–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å</button>
<p id="result5" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(5)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 6: –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä -->
<section class="scene hidden" id="path6">
<h2>–§–∞–∑–∞ 6 ‚Äì –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä</h2>
<p id="finalText"></p>
<button class="btn" id="choice6a" onclick="chooseAction(6, 'save')"></button>
<button class="btn" id="choice6b" onclick="chooseAction(6, 'leave')"></button>
<p id="result6" class="hidden">–ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω –ø–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º! –≠—Ç–æ—Ç –∫–ª—é—á (üîë) —Ä–∞–≤–µ–Ω 25. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ–≥–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å–∫–≤–∞–∂–∏–Ω—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø.</p>
<div class="inventory-item draggable" id="keyCenter" draggable="true" ondragstart="drag(event)">
  üîë
</div>
<div id="keyDropzonesContainer">
  <div class="dropzone key-drop" data-answer="25">5√ó5</div>
  <div class="dropzone key-drop" data-answer="20">10+10</div>
  <div class="dropzone key-drop" data-answer="26">30-4</div>
  <div class="dropzone key-drop" data-answer="16.67">50/3</div>
</div>
<p id="attemptsInfo"></p>
<div id="extraChallenge" class="hidden">
  <button class="btn" id="extraChallengeBtn" onclick="showNextStep(7)">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è</button>
</div>
<button class="btn back-btn" onclick="goBack(6)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 7: –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è -->
<section class="scene hidden" id="path7">
<h2>–§–∞–∑–∞ 7 ‚Äì –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è</h2>
<p>–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—å –º–∏—Å—Å–∏—é, —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞—à–µ–π —Ä–µ–∞–∫—Ü–∏–∏! –ü–æ–π–º–∞–π—Ç–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –ø–∞–¥–∞—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!</p>
<canvas id="reactionGame" width="500" height="350" class="game-canvas"></canvas>
<p id="reactionResult" class="hidden"></p>
<button class="btn hidden" id="restartGameBtn" onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
<div>
  <button class="btn" onclick="showNextStep(8)">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –∑–∞–¥–∞–Ω–∏—é</button>
</div>
<button class="btn back-btn" onclick="goBack(7)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –§–∞–∑–∞ 8: –ú–∏–≥–∞–ª–∫–∞ -->
<section class="scene hidden" id="path8">
<h2>–§–∞–∑–∞ 8 ‚Äì –ú–∏–≥–∞–ª–∫–∞</h2>
<p>–í–∞—à–∞ –º–∏—Å—Å–∏—è –±–ª–∏–∑–∫–∞ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–≥–∞—é—â—É—é —Ç–æ—á–∫—É –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ!</p>
<canvas id="blinkGame" width="500" height="350" class="game-canvas"></canvas>
<p id="blinkResult" class="hidden"></p>
<button class="btn hidden" id="restartBlinkBtn" onclick="restartBlinkGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
<div>
  <button class="btn" onclick="showEnding(1)">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
</div>
<button class="btn back-btn" onclick="goBack(8)">–ù–∞–∑–∞–¥</button>
</section>

<!-- –ö–æ–Ω—Ü–æ–≤–∫–∏ -->
<div class="ending" id="ending1">
<h2>–¢—Ä–∏—É–º—Ñ —Ö–∞–∫–µ—Ä–∞!</h2>
<img src="https://i.postimg.cc/HkBMfR38/file-00000000757061f8a4740df6f148b3f4-conversation-id-67f90bca-1d9c-8012-90ff-ad1c6de7e000-message-i.png" alt="Victory Scene" class="ending-image">
<p>–í–∞—à –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –≤–∑–ª–æ–º —Å–ø–∞—Å –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –õ–æ–≥–∞—Ä–∏—Ñ–º–∞! –í—ã —Ä–∞–∑—Ä—É—à–∏–ª–∏ –ø–ª–∞–Ω—ã "ZeroDivision", –∏ —Ç–µ–ø–µ—Ä—å –º–∏—Ä –Ω–∞—É–∫–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–∞–º!</p>
<button class="btn menu-btn" onclick="window.location.href='index.html'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
</div>
<div class="ending sad-ending" id="ending2">
<h2>–¢—è–∂—ë–ª—ã–π –≤—ã–±–æ—Ä...</h2>
<img src="https://i.postimg.cc/HLNyLMqp/file-0000000048f461f88461417d7faf5243-conversation-id-67f90bca-1d9c-8012-90ff-ad1c6de7e000-message-i.png" alt="Failure Scene" class="ending-image">
<p>–í—ã —É—à–ª–∏ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏, —Ä–∞—Å–∫—Ä—ã–≤ —á–∞—Å—Ç—å —Ç–∞–π–Ω "ZeroDivision". –ù–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä –æ—Å—Ç–∞–ª—Å—è –≤ –ø–ª–µ–Ω—É, –∏ –µ–≥–æ —Å—É–¥—å–±–∞ —Ç–µ—Ä–∑–∞–µ—Ç –≤–∞—à—É —Å–æ–≤–µ—Å—Ç—å...</p>
<button class="btn menu-btn" onclick="window.location.href='index.html'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
</div>
<div class="ending sad-ending" id="ending3">
<h2>–ü—É—Ç—å –æ–¥–∏–Ω–æ—á–∫–∏</h2>
<img src="https://i.postimg.cc/HLNyLMqp/file-0000000048f461f88461417d7faf5243-conversation-id-67f90bca-1d9c-8012-90ff-ad1c6de7e000-message-i.png" alt="Failure Scene" class="ending-image">
<p>–í—ã –ø—Ä–µ–¥–ø–æ—á–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ—Å—Ç–∞–≤–∏–≤ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –Ω–∞ –º–∏–ª–æ—Å—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏. "ZeroDivision" –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–≤–æ–∏ —Ç—ë–º–Ω—ã–µ –¥–µ–ª–∞, –∞ –≤—ã —Å–∫—Ä—ã–≤–∞–µ—Ç–µ—Å—å –≤ —Ç–µ–Ω—è—Ö...</p>
<button class="btn menu-btn" onclick="window.location.href='index.html'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
</div>
</main>

<!-- –ö–∞–Ω–≤–∞—Å—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π –∫–æ–Ω—Ü–æ–≤–æ–∫ -->
<canvas id="confettiCanvas" class="effect-canvas"></canvas>
<canvas id="rainCanvas" class="effect-canvas"></canvas>

<script>
let currentStep = 1;
let wiresConnected = {};
let activeConnection = null;
let choicesMade = {};
let keyAttempts = 3;
const wireCanvas = document.getElementById('wireCanvas');
const wireCtx = wireCanvas.getContext('2d');
wireCanvas.width = 800;
wireCanvas.height = 600;

function factorial(n) {
if (n === 0 || n === 1) return 1;
return n * factorial(n - 1);
}

function updateAttemptsInfo() {
document.getElementById('attemptsInfo').textContent = "–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: " + keyAttempts;
}
updateAttemptsInfo();

const matrixCanvas = document.getElementById('matrix');
const matrixCtx = matrixCanvas.getContext('2d');
matrixCanvas.width = window.innerWidth;
matrixCanvas.height = window.innerHeight;
const chars = '01';
const fontSize = 18;
const columns = matrixCanvas.width / fontSize;
const drops = Array(Math.floor(columns)).fill(0);

function drawMatrix() {
matrixCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
matrixCtx.fillStyle = '#00ff00';
matrixCtx.font = fontSize + 'px monospace';
drops.forEach((y, i) => {
  const text = chars[Math.floor(Math.random() * chars.length)];
  const x = i * fontSize;
  matrixCtx.fillText(text, x, y);
  if (y > matrixCanvas.height && Math.random() > 0.975) drops[i] = 0;
  drops[i] += fontSize;
});
requestAnimationFrame(drawMatrix);
}
drawMatrix();

function startPath() {
document.getElementById('scene1').className = 'scene hidden';
document.getElementById('path1').className = 'scene';
currentStep = 1;
}

function goBack(step) {
if (step === 1) {
  document.getElementById(`path${step}`).className = 'scene hidden';
  document.getElementById('scene1').className = 'scene';
  currentStep = 1;
} else {
  showNextStep(step - 1);
}
// Reset phase-specific data if needed
if (step === 2) {
  wiresConnected = {};
  activeConnection = null;
  wireCtx.clearRect(0, 0, wireCanvas.width, wireCanvas.height);
}
if (step === 6) {
  keyAttempts = 3;
  updateAttemptsInfo();
  document.getElementById('keyCenter').style.display = 'block';
}
}

function unlockItem(element, expectedAnswer, hiddenEmoji, equation) {
let answer = prompt(`–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ:\n${equation}\n(–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º):`);
if (answer && answer.trim() === expectedAnswer) {
  element.classList.remove("locked");
  element.textContent = hiddenEmoji;
  if (hiddenEmoji === "üîë") {
    document.getElementById('result1').textContent = "–ö–ª—é—á –Ω–∞–π–¥–µ–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
    document.getElementById('result1').className = "";
    addChoices(1);
  }
} else {
  alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
}
}

let isDragging = false;
let currentWire = null;
let mouseX = 0;
let mouseY = 0;
let wireStartX = 0;
let wireStartY = 0;

function startDraggingWire(id, startPoint, event) {
    event.preventDefault();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø—Ä–æ–≤–æ–¥
    if (wiresConnected[id]) {
        const rect = wireCanvas.getBoundingClientRect();
        const clickX = event.clientX - rect.left;
        const clickY = event.clientY - rect.top;
        const wire = wiresConnected[id];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –æ–±–æ–∏—Ö –∫–æ–Ω—Ü–æ–≤ –ø—Ä–æ–≤–æ–¥–∞
        const startDist = Math.sqrt((clickX - wire.startX) ** 2 + (clickY - wire.startY) ** 2);
        const endDist = Math.sqrt((clickX - wire.endX) ** 2 + (clickY - wire.endY) ** 2);
        
        // –ï—Å–ª–∏ –∫–ª–∏–∫ –±–ª–∏–∑–∫–æ –∫ –ª—é–±–æ–º—É –∫–æ–Ω—Ü—É –ø—Ä–æ–≤–æ–¥–∞ - –æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ–º –µ–≥–æ
        if (startDist < 40 || endDist < 40) {
            delete wiresConnected[id];
            drawWires();
            return;
        }
    }
    
    isDragging = true;
    const rect = wireCanvas.getBoundingClientRect();
    const startRect = startPoint.getBoundingClientRect();
    
    wireStartX = startRect.left - rect.left + startRect.width / 2;
    wireStartY = startRect.top - rect.top + startRect.height / 2;
    
    currentWire = {
        id: id,
        startX: wireStartX,
        startY: wireStartY,
        startPoint: startPoint
    };
    
    startPoint.classList.add('active');
    
    document.addEventListener('mousemove', handleWireDrag);
    document.addEventListener('mouseup', handleWireRelease);
}

function handleWireDrag(event) {
  if (!isDragging || !currentWire) return;
  
  event.preventDefault();
  
  const rect = wireCanvas.getBoundingClientRect();
  mouseX = event.clientX - rect.left;
  mouseY = event.clientY - rect.top;
  
  drawWires();
}

function handleWireRelease(event) {
  if (!isDragging || !currentWire) return;
  
  event.preventDefault();
  
  const rect = wireCanvas.getBoundingClientRect();
  const endPoint = document.elementFromPoint(event.clientX, event.clientY);
  
  if (endPoint && endPoint.classList.contains('wire-point') && endPoint.id.startsWith('right')) {
    const endRect = endPoint.getBoundingClientRect();
    const equation = endPoint.dataset.equation;
    const computed = eval(equation);
    const startValue = parseInt(currentWire.startPoint.textContent);
    
    if (startValue === computed) {
      wiresConnected[currentWire.id] = {
        startX: currentWire.startX,
        startY: currentWire.startY,
        endX: endRect.left - rect.left + endRect.width / 2,
        endY: endRect.top - rect.top + endRect.height / 2,
        controlPoint1X: 0,
        controlPoint1Y: 0,
        controlPoint2X: 0,
        controlPoint2Y: 0
      };
      updateWirePhysics(wiresConnected[currentWire.id]);
      checkWires();
    }
  }
  
  // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  currentWire.startPoint.classList.remove('active');
  isDragging = false;
  currentWire = null;
  
  // –£–¥–∞–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏
  document.removeEventListener('mousemove', handleWireDrag);
  document.removeEventListener('mouseup', handleWireRelease);
  
  drawWires();
}

function updateWirePhysics(wire) {
    const dx = wire.endX - wire.startX;
    const dy = wire.endY - wire.startY;
    const distance = Math.sqrt(dx * dx + dy * dy);
    
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–æ–≤–∏—Å–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã –ø—Ä–æ–≤–æ–¥–∞
    const sag = distance * 0.15;
    
    // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–π –∫—Ä–∏–≤–æ–π
    wire.controlPoint1X = wire.startX + dx * 0.25;
    wire.controlPoint1Y = wire.startY + dy * 0.25 + sag;
    
    wire.controlPoint2X = wire.startX + dx * 0.75;
    wire.controlPoint2Y = wire.startY + dy * 0.75 + sag;
}

function drawWirePath(wire, isTemp = false) {
    wireCtx.beginPath();
    wireCtx.strokeStyle = "#00ff00";
    wireCtx.lineWidth = 4;
    wireCtx.lineCap = "round";
    
    if (isTemp) {
        const dx = wire.endX - wire.startX;
        const dy = wire.endY - wire.startY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const sag = distance * 0.15;
        
        const cp1x = wire.startX + dx * 0.25;
        const cp1y = wire.startY + dy * 0.25 + sag;
        const cp2x = wire.startX + dx * 0.75;
        const cp2y = wire.startY + dy * 0.75 + sag;
        
        wireCtx.moveTo(wire.startX, wire.startY);
        wireCtx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, wire.endX, wire.endY);
    } else {
        wireCtx.moveTo(wire.startX, wire.startY);
        wireCtx.bezierCurveTo(
            wire.controlPoint1X, wire.controlPoint1Y,
            wire.controlPoint2X, wire.controlPoint2Y,
            wire.endX, wire.endY
        );
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è
    wireCtx.shadowColor = "#00ff00";
    wireCtx.shadowBlur = 15;
    wireCtx.stroke();
    wireCtx.shadowBlur = 0;
}

function drawWires() {
    wireCtx.clearRect(0, 0, wireCanvas.width, wireCanvas.height);
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    for (let id in wiresConnected) {
        const wire = wiresConnected[id];
        drawWirePath(wire);
    }
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–≤–æ–¥–∞
    if (isDragging && currentWire) {
        drawWirePath({
            startX: currentWire.startX,
            startY: currentWire.startY,
            endX: mouseX,
            endY: mouseY
        }, true);
    }
}

function checkWires() {
    const requiredConnections = [
        ['v1', 'right4'], // 16 = 2‚Å¥
        ['v2', 'right3'], // 6 = 3!
        ['v3', 'right2'], // 2 = ‚àö4
        ['v4', 'right1'], // 1 = cos(0)
        ['v5', 'right5'], // 24 = 2¬≥√ó3
        ['v6', 'right6']  // 8 = 2¬≥
    ];

    let allCorrect = requiredConnections.every(([wireId, targetId]) => {
        if (!wiresConnected[wireId]) return false;
        const targetElement = document.getElementById(targetId);
        const targetRect = targetElement.getBoundingClientRect();
        const wireRect = wireCanvas.getBoundingClientRect();
        const endX = targetRect.left - wireRect.left + targetRect.width / 2;
        const endY = targetRect.top - wireRect.top + targetRect.height / 2;
        
        return Math.abs(wiresConnected[wireId].endX - endX) < 10 && 
               Math.abs(wiresConnected[wireId].endY - endY) < 10;
    });

    if (allCorrect) {
        setTimeout(() => {
            document.getElementById('wireTask').style.boxShadow = '0 0 20px #00ff00';
            document.getElementById('result2').textContent = "–°—Ö–µ–º–∞ —Å–æ–±—Ä–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ.";
            document.getElementById('result2').className = "";
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
            if (!document.getElementById('continueBtn')) {
                const continueBtn = document.createElement('button');
                continueBtn.id = 'continueBtn';
                continueBtn.className = 'btn';
                continueBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                continueBtn.onclick = () => showNextStep(3);
                document.getElementById('result2').appendChild(continueBtn);
            }
        }, 500);
    }
}

function solveRebus() {
let answer = prompt("–†–µ–±—É—Å:\n1. –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ —Å–ª–æ–≤–∞ ¬´—Å–µ–∫—Ä–µ—Ç¬ª;\n2. –ö–æ—Ä–µ–Ω—å —Å–ª–æ–≤–∞ ¬´–∫—Ä—ã—à–∞¬ª (–ø–µ—Ä–≤—ã–µ —Ç—Ä–∏ –±—É–∫–≤—ã);\n3. –û–∫–æ–Ω—á–∞–Ω–∏–µ —Å–ª–æ–≤–∞ ¬´–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å¬ª (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —á–µ—Ç—ã—Ä–µ –±—É–∫–≤—ã).\n\n–í—Å—Ç–∞–≤—å—Ç–µ –±—É–∫–≤—ã ¬´–¢–ù¬ª –º–µ–∂–¥—É 2-–π –∏ 3-–π —á–∞—Å—Ç—è–º–∏. –ö–∞–∫–æ–π –ø–æ–ª—É—á–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç?");
if (answer && answer.trim().toLowerCase() === "—Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å") {
  document.getElementById('result3').textContent = "–†–µ–±—É—Å —Ä–∞–∑–≥–∞–¥–∞–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
  document.getElementById('result3').className = "";
  addChoices(3);
} else {
  alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
}
}

function solveCipher() {
let answer = prompt("–†–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:\n\"–ª–ø–µ —Ä—Å–ø—Ö–∂—Ç—Ç–ø—Å–± –º–ø–¥–±—Å–π—Ö–Ω–±\"\n–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–¥–≤–∏–Ω—å—Ç–µ –∫–∞–∂–¥—É—é –±—É–∫–≤—É –Ω–∞ 1 –Ω–∞–∑–∞–¥.");
if (answer && answer.trim().toLowerCase() === "–∫–æ–¥ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –ª–æ–≥–∞—Ä–∏—Ñ–º–∞") {
  document.getElementById('result4').textContent = "–®–∏—Ñ—Ä —Ä–∞–∑–≥–∞–¥–∞–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
  document.getElementById('result4').className = "";
  addChoices(4);
} else {
  alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
}
}

function drag(event) {
event.dataTransfer.setData("text", event.target.id);
}

function setupKeyDropzones() {
document.querySelectorAll('.key-drop').forEach(dropzone => {
  dropzone.ondragover = (event) => event.preventDefault();
  dropzone.ondrop = function(event) {
    event.preventDefault();
    let itemId = event.dataTransfer.getData("text");
    if (itemId === 'keyCenter') {
      if (this.dataset.answer === "25") {
        this.innerHTML = "–ö–ª—é—á –≤—Å—Ç–∞–≤–ª–µ–Ω!";
        showEnding(choicesMade[5] === 'hack' ? (choicesMade[6] === 'save' ? 1 : 3) : 2);
      } else {
        keyAttempts--;
        updateAttemptsInfo();
        if (keyAttempts <= 0) {
          alert("–ü–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã! –ù–∞—á–Ω–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ñ–∞–∑—É –∑–∞–Ω–æ–≤–æ.");
          keyAttempts = 3;
          updateAttemptsInfo();
          document.getElementById('keyCenter').style.display = 'block';
        } else {
          alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∫–≤–∞–∂–∏–Ω–∞! –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: " + keyAttempts);
        }
      }
    }
  };
});
}

function addChoices(step) {
let result = document.getElementById(`result${step}`);
result.innerHTML += `
  <br><button class="btn" onclick="chooseAction(${step}, 'continue')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  <button class="btn" onclick="chooseAction(${step}, 'restart')">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
`;
}

function chooseAction(step, action) {
if (action === 'continue' && step < 5) {
  showNextStep(step + 1);
} else if (action === 'restart') {
  showNextStep(1);
  wiresConnected = {};
  choicesMade = {};
  activeConnection = null;
  wireCtx.clearRect(0, 0, wireCanvas.width, wireCanvas.height);
} else if (step === 5) {
  choicesMade[5] = action;
  document.getElementById('result5').textContent = action === 'hack' ?
    "–¢–µ—Ä–º–∏–Ω–∞–ª –≤–∑–ª–æ–º–∞–Ω! –ó–∞ —Å—Ç–µ–∫–ª–æ–º –≤–∏–¥–Ω–µ–µ—Ç—Å—è —Å–∏–ª—É—ç—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞." :
    "–í—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —Ç–∞–π–Ω—ã–π –≤—ã—Ö–æ–¥ —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.";
  document.getElementById('result5').className = "";
  document.getElementById('finalText').textContent = action === 'hack' ?
    "–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä —Ä–∞–Ω–µ–Ω, –Ω–æ –∂–∏–≤. –°–ø–∞—Å—Ç–∏ –µ–≥–æ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤ –æ–¥–∏–Ω–æ—á–∫—É?" :
    "–î–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–∞–≤–¥—É, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç–∏. –í–∞—à –≤—ã–±–æ—Ä?";
  document.getElementById('choice6a').textContent = action === 'hack' ? "–°–ø–∞—Å—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞" : "–£–π—Ç–∏ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏";
  document.getElementById('choice6b').textContent = action === 'hack' ? "–û—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ" : "–í–µ—Ä–Ω—É—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞";
  showNextStep(6);
} else if (step === 6) {
  choicesMade[6] = action;
  document.getElementById('result6').className = "";
  let key = document.getElementById('keyCenter');
  key.style.display = 'block';
  setupKeyDropzones();
}
}

function showNextStep(step) {
document.getElementById(`path${currentStep}`).className = 'scene hidden';
currentStep = step;
document.getElementById(`path${currentStep}`).className = 'scene';
if (currentStep === 7) {
  startGame();
}
if (currentStep === 8) {
  startBlinkGame();
}
}

function showEnding(ending) {
const key = document.getElementById('keyCenter');
if (key) {
  key.style.display = 'none';
}
document.querySelectorAll('.scene').forEach(scene => {
  scene.className = 'scene hidden';
});
document.getElementById(`ending${ending}`).style.display = 'flex';
if (ending === 1) {
  startConfetti();
} else {
  startRain();
}
}

// –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –¥–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Ü–æ–≤–∫–∏
const confettiCanvas = document.getElementById('confettiCanvas');
const confettiCtx = confettiCanvas.getContext('2d');
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;

function startConfetti() {
let particles = [];

function createParticle() {
  return {
    x: Math.random() * confettiCanvas.width,
    y: -10,
    vx: (Math.random() - 0.5) * 6,
    vy: Math.random() * 6 + 3,
    size: Math.random() * 8 + 5,
    life: 150,
    color: `hsl(${Math.random() * 360}, 80%, 60%)`,
    shape: Math.random() < 0.5 ? 'square' : 'circle'
  };
}

function updateParticles() {
  if (particles.length < 100 && Math.random() < 0.3) {
    particles.push(createParticle());
  }
  particles = particles.filter(p => p.life > 0 && p.y < confettiCanvas.height + p.size);
  confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.vx += (Math.random() - 0.5) * 0.2;
    p.life--;
    confettiCtx.beginPath();
    confettiCtx.fillStyle = p.color;
    if (p.shape === 'square') {
      confettiCtx.fillRect(p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
    } else {
      confettiCtx.arc(p.x, p.y, p.size / 2, 0, Math.PI * 2);
      confettiCtx.fill();
    }
  });
  requestAnimationFrame(updateParticles);
}

updateParticles();
}

// –î–æ–∂–¥—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ü–æ–≤–æ–∫
const rainCanvas = document.getElementById('rainCanvas');
const rainCtx = rainCanvas.getContext('2d');
rainCanvas.width = window.innerWidth;
rainCanvas.height = window.innerHeight;

function startRain() {
let drops = [];

function createDrop() {
  return {
    x: Math.random() * rainCanvas.width,
    y: -10,
    length: Math.random() * 20 + 10,
    speed: Math.random() * 5 + 5,
    opacity: Math.random() * 0.5 + 0.3
  };
}

function updateDrops() {
  if (drops.length < 80 && Math.random() < 0.4) {
    drops.push(createDrop());
  }
  drops = drops.filter(d => d.y < rainCanvas.height + d.length);
  rainCtx.clearRect(0, 0, rainCanvas.width, rainCanvas.height);
  drops.forEach(d => {
    d.y += d.speed;
    rainCtx.beginPath();
    rainCtx.strokeStyle = `rgba(0, 191, 255, ${d.opacity})`;
    rainCtx.lineWidth = 2;
    rainCtx.moveTo(d.x, d.y);
    rainCtx.lineTo(d.x, d.y + d.length);
    rainCtx.stroke();
  });
  requestAnimationFrame(updateDrops);
}

updateDrops();
}

let gameObjects = [];
let score = 0;
let gameInterval = null;
let gameStartTime = 0;
const gameCanvas = document.getElementById('reactionGame');
const gameCtx = gameCanvas.getContext('2d');

function startGame() {
score = 0;
gameObjects = [];
gameStartTime = Date.now();
document.getElementById('reactionResult').classList.add('hidden');
document.getElementById('restartGameBtn').classList.add('hidden');
gameCanvas.addEventListener('click', gameClick);
gameInterval = setInterval(updateGame, 50);
}

function updateGame() {
const elapsed = Date.now() - gameStartTime;
if (Math.random() < 0.1) {
  gameObjects.push({
    x: Math.random() * (gameCanvas.width - 20),
    y: -20,
    r: 18,
    speed: 2 + Math.random() * 3
  });
}
gameObjects.forEach(obj => {
  obj.y += obj.speed;
});
gameObjects = gameObjects.filter(obj => obj.y - obj.r < gameCanvas.height);
drawGame();
if (elapsed > 10000) {
  endGame();
}
}

function drawGame() {
gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
gameObjects.forEach(obj => {
  gameCtx.beginPath();
  gameCtx.fillStyle = "#00ff00";
  gameCtx.arc(obj.x, obj.y, obj.r, 0, Math.PI * 2);
  gameCtx.fill();
});
gameCtx.font = "24px Courier New";
gameCtx.fillStyle = "#00ff00";
gameCtx.fillText("–°—á—ë—Ç: " + score, 10, 30);
}

function gameClick(event) {
const rect = gameCanvas.getBoundingClientRect();
const clickX = event.clientX - rect.left;
const clickY = event.clientY - rect.top;
for (let i = 0; i < gameObjects.length; i++) {
  const obj = gameObjects[i];
  const dist = Math.sqrt((clickX - obj.x) ** 2 + (clickY - obj.y) ** 2);
  if (dist < obj.r) {
    score++;
    gameObjects.splice(i, 1);
    break;
  }
}
}

function endGame() {
clearInterval(gameInterval);
gameCanvas.removeEventListener('click', gameClick);
document.getElementById('reactionResult').textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + score;
document.getElementById('reactionResult').className = "";
document.getElementById('restartGameBtn').classList.remove('hidden');
}

function restartGame() {
startGame();
}

let blinkInterval = null;
let blinkScore = 0;
let blinkGameActive = false;
const blinkCanvas = document.getElementById('blinkGame');
const blinkCtx = blinkCanvas.getContext('2d');
let currentBlink = null;

function startBlinkGame() {
blinkScore = 0;
blinkGameActive = true;
document.getElementById('blinkResult').classList.add('hidden');
document.getElementById('restartBlinkBtn').classList.add('hidden');
blinkCanvas.addEventListener('click', blinkGameClick);
blinkInterval = setInterval(updateBlinkGame, 1000);
setTimeout(endBlinkGame, 10000);
drawBlinkGame();
}

function updateBlinkGame() {
currentBlink = {
  x: Math.random() * (blinkCanvas.width - 40) + 20,
  y: Math.random() * (blinkCanvas.height - 40) + 20,
  r: 18
};
drawBlinkGame();
}

function drawBlinkGame() {
blinkCtx.clearRect(0, 0, blinkCanvas.width, blinkCanvas.height);
if (currentBlink) {
  blinkCtx.beginPath();
  blinkCtx.fillStyle = "#00ff00";
  blinkCtx.arc(currentBlink.x, currentBlink.y, currentBlink.r, 0, Math.PI * 2);
  blinkCtx.fill();
}
blinkCtx.font = "24px Courier New";
blinkCtx.fillStyle = "#00ff00";
blinkCtx.fillText("–°—á—ë—Ç: " + blinkScore, 10, 30);
}

function blinkGameClick(event) {
if (!currentBlink) return;
const rect = blinkCanvas.getBoundingClientRect();
const clickX = event.clientX - rect.left;
const clickY = event.clientY - rect.top;
const dist = Math.sqrt((clickX - currentBlink.x) ** 2 + (clickY - currentBlink.y) ** 2);
if (dist < currentBlink.r) {
  blinkScore++;
  currentBlink = null;
  drawBlinkGame();
}
}

function endBlinkGame() {
clearInterval(blinkInterval);
blinkCanvas.removeEventListener('click', blinkGameClick);
blinkGameActive = false;
document.getElementById('blinkResult').textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + blinkScore;
document.getElementById('blinkResult').className = "";
document.getElementById('restartBlinkBtn').classList.remove('hidden');
}

function restartBlinkGame() {
startBlinkGame();
}
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'930a4f1c0987b03f',t:'MTc0NDcwODIxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'930a70d04dc9adc3',t:'MTc0NDcwOTU5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9316d42f8c4f53b2',t:'MTc0NDgzOTQ5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>